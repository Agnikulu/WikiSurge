# Development Configuration
features:
  elasticsearch_indexing: true
  trending: true
  edit_wars: true
  websockets: true

ingestor:
  exclude_bots: true
  allowed_languages: ["en", "es", "fr", "de"]
  allowed_namespaces: [0]     # Main namespace only (0=articles)
  rate_limit: 100
  burst_limit: 200
  reconnect_delay: 1s
  max_reconnect_delay: 60s
  metrics_port: 2112

elasticsearch:
  enabled: true
  url: "http://localhost:9200"
  retention_days: 7
  max_docs_per_day: 10000
  selective_criteria:
    trending_top_n: 10000
    spike_ratio_min: 1.1
    edit_war_enabled: true
    sample_rate: 0.5  # Index 50% of all edits for better search coverage

redis:
  url: "redis://localhost:6379"
  max_memory: "256mb"
  eviction_policy: "allkeys-lru"
  hot_pages:
    max_tracked: 1000
    promotion_threshold: 5
    window_duration: 15m
    max_members_per_page: 100
    hot_threshold: 2
    cleanup_interval: 5m
  trending:
    enabled: true
    max_pages: 1000
    half_life_minutes: 30.0
    prune_interval: 5m

kafka:
  brokers:
    - "localhost:19092"
  consumer_group: "wikisurge-dev"
  max_poll_records: 500
  session_timeout: 30s

api:
  port: 8080
  rate_limit: 1000
  max_websocket_connections: 1000
  rate_limiting:
    enabled: true
    requests_per_minute: 1000
    burst_size: 100
    key_type: "ip"
    whitelist:
      - "127.0.0.1"
      - "::1"
      - "10.0.0.0/8"
      - "192.168.0.0/16"

logging:
  level: "info"
  format: "json"

# --- Authentication ---
auth:
  jwt_secret: "dev-secret-change-me-in-production"  # Override: JWT_SECRET env var
  jwt_expiry: 24h

# --- User Database (SQLite) ---
database:
  path: "data/wikisurge.db"

# --- Digest Email ---
# For development: provider "log" prints emails to console (no real sending).
# For production: use "resend" (free 3K/month) or "smtp".
# Quick start:
#   1. Sign up at https://resend.com â†’ get API key
#   2. Set EMAIL_API_KEY env var (auto-enables email + sets provider to resend)
#   OR set email.enabled + email.provider + email.api_key below
email:
  enabled: false              # Set to true (or set EMAIL_API_KEY env var) to enable
  provider: "log"             # "log" = console only | "resend" | "smtp"
  api_key: ""                 # Override: EMAIL_API_KEY env var
  from_address: "digest@wikisurge.net"
  from_name: "WikiSurge"
  dashboard_url: "http://localhost:5173"
  daily_send_hour: 8          # UTC hour (0-23) to send daily digests
  weekly_send_day: 1          # 0=Sunday, 1=Monday, ...
  weekly_send_hour: 8
  max_concurrent_sends: 10
  # SMTP settings (only used when provider: "smtp")
  # smtp_host: "smtp.gmail.com"
  # smtp_port: 587
  # smtp_user: ""
  # smtp_pass: ""

# LLM configuration for edit war conflict analysis.
# Set LLM_API_KEY env var or configure api_key below.
# Supported providers: openai, anthropic, ollama
llm:
  enabled: true            # LLM analysis for edit wars
  provider: "openai"       # "openai" | "anthropic" | "ollama"
  api_key: ""              # Override with LLM_API_KEY env var
  model: "gpt-4o-mini"    # Cost-effective default; or "claude-3-haiku-20240307"
  # base_url: ""           # Override for Ollama: "http://localhost:11434"
  max_tokens: 700
  temperature: 0.3
  timeout: 30s
  cache_ttl: 4h            # How long to cache LLM responses per page
  reanalyze_every: 10      # Re-run LLM analysis every N edits on an active edit war