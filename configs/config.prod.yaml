# Ultra-Budget Configuration - Minimum viable deployment
# Target: 2GB RAM server ($12/month DigitalOcean, $4/month Hetzner CAX11)
# Retention: 3 hours for all data
# Memory footprint: ~1.2GB total (leaves headroom for OS)
#
# Trade-offs:
#   - NO Grafana/Prometheus (use /metrics endpoints directly if needed)
#   - English Wikipedia only
#   - 3-hour data retention
#   - 100 max WebSocket connections

features:
  elasticsearch_indexing: true   # ENABLED - search available
  trending: true
  edit_wars: true
  websockets: true

ingestor:
  exclude_bots: true
  allowed_languages: []           # Empty = all languages accepted
  allowed_namespaces: [0]        # Main articles only
  rate_limit: 50                 # Lower rate limit
  burst_limit: 100
  reconnect_delay: 2s
  max_reconnect_delay: 60s
  metrics_port: 2112

elasticsearch:
  enabled: true
  url: "http://elasticsearch:9200"
  retention_days: 1
  max_docs_per_day: 50000
  selective_criteria:
    trending_top_n: 5000
    spike_ratio_min: 1.1
    edit_war_enabled: true
    sample_rate: 0.3  # Index 30% of edits

redis:
  url: "redis://redis:6379"
  max_memory: "256mb"            # Increased for 8GB server
  eviction_policy: "allkeys-lru"
  hot_pages:
    max_tracked: 200             # Reduced tracking
    promotion_threshold: 5
    window_duration: 10m
    max_members_per_page: 30
    hot_threshold: 3
    cleanup_interval: 3m
  trending:
    enabled: true
    max_pages: 200               # Limited trending pages
    half_life_minutes: 20.0      # Faster decay for 3h window
    prune_interval: 3m

kafka:
  brokers:
    - "kafka:9092"
  consumer_group: "wikisurge-ultra"
  max_poll_records: 100
  session_timeout: 30s

api:
  port: 8081
  rate_limit: 500
  max_websocket_connections: 100  # Limited connections
  rate_limiting:
    enabled: true
    requests_per_minute: 500
    burst_size: 50
    key_type: "ip"
    whitelist:
      - "127.0.0.1"
      - "::1"

logging:
  level: "info"                  # Info level for visibility; switch to "error" once stable
  format: "json"

# --- Authentication ---
auth:
  jwt_secret: ""              # REQUIRED in production â€” set JWT_SECRET env var
  jwt_expiry: 24h

# --- User Database (SQLite) ---
database:
  path: "/data/wikisurge.db"   # Persistent volume in Docker

# --- Digest Email ---
# Set EMAIL_API_KEY env var to auto-enable with Resend.
# Or configure SMTP for self-hosted sending.
email:
  enabled: true
  provider: "resend"           # "resend" | "smtp" | "log"
  api_key: ""                  # Override: EMAIL_API_KEY env var
  from_address: "digest@wikisurge.net"
  from_name: "WikiSurge"
  dashboard_url: "https://wikisurge.net"   # Your actual domain
  daily_send_hour: 8
  weekly_send_day: 1
  weekly_send_hour: 8
  max_concurrent_sends: 10
  # smtp_host: ""
  # smtp_port: 587
  # smtp_user: ""
  # smtp_pass: ""

# LLM configuration for edit war conflict analysis.
# Override via LLM_ENABLED, LLM_API_KEY, etc. env vars.
llm:
  enabled: false           # Use LLM_ENABLED env var to enable
  provider: "openai"
  api_key: ""              # Override with LLM_API_KEY env var
  model: "gpt-4o-mini"
  max_tokens: 512
  temperature: 0.3
  timeout: 30s
  cache_ttl: 4h
  reanalyze_every: 5
